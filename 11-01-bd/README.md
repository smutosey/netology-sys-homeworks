# Домашнее задание к занятию "`11.1. Базы данных, их типы`" - `Александр Недорезов`

### Задание 1. СУБД

#### Кейс
Крупная строительная компания, которая также занимается проектированием и девелопментом, решила создать правильную архитектуру для работы с данными. Ниже представлены задачи, которые необходимо решить для каждой предметной области. 

Какие типы СУБД, на ваш взгляд, лучше всего подойдут для решения этих задач и почему? 
 
1.1. Бюджетирование проектов с дальнейшим формированием финансовых аналитических отчётов и прогнозирования рисков.
СУБД должна гарантировать целостность и чёткую структуру данных.

> #### Ответ:
> 
> Следует использовать реляционную БД (PostgreSQL, MySQL). Они обеспечивают высокую нормализацию данных, в БД можно заранее спроектировать необходимую структуру (проекты, бюджет, клиенты, товарно-материальные ценности и т.д.) и достаточно удобно и эффективно строить финансовые отчеты.

1.1.* Хеширование стало занимать длительно время, какое API можно использовать для ускорения работы? 

> #### Ответ:
> 
> В СУБД *хеширование* – это метод прямого поиска местоположения нужных данных на диске без использования структуры индекса. Получается, если хеширование стало занимать длительное время, то скорее всего сильно возросло количество строк, из которых делаются выборки, и это привело к длительному формированию финансовых отчетов.  
> Если ограничиваться выбором API из SQL/ООП/REST/GraphQL, то, наверное, следует попробовать использовать функции ООП (если СУБД это поддерживает, конечно). С помощью высокоуровневого кода можно эффективно оптимизировать сложные аналитические выборки.  
> На мой взгляд, если данных действительно много (сотни миллионов строк в таблице), то можно рассмотреть, как дополнение колоночную СУБД (ClickHouse, Cassandra), т.к. они лучше справляются с быстрым доступом к большим данным и отлично справляются со сложными аналитическими выборками. Из минусов - намного менее понятная структура данных, особенно для "бизнеса", а также не удовлетворяет требованию консистентности данных.   

1.2. Под каждый девелоперский проект создаётся отдельный лендинг, и все данные по лидам стекаются в CRM к маркетологам и менеджерам по продажам. Какой тип СУБД лучше использовать для лендингов и для CRM? СУБД должны быть гибкими и быстрыми.

> #### Ответ:
> 
> Для данных по лидам с лендинга (т.е. та часть аудитории, которая заинтересовалась предложением на странице и захотела подробностей), можно использовать NoSQL СУБД ключ-значение (Redis), либо документно-ориентированной (MongoDB). Эти СУБД отлично справятся с хранением простых объектов   
> Для CRM всё-таки оптимальнее использовать реляционную СУБД с четкой структурой, т.к. там опять же будет много взаимосвязанных данных, к которым должны получать одновременный доступ множество менеджеров, и тут выполняется требование к согласованности данных и доступности (CA)  

1.2.* Можно ли эту задачу закрыть одной СУБД? И если да, то какой именно СУБД и какой реализацией?

> #### Ответ:
> 
> Да, можно для этих задач использовать документно-ориентированную СУБД MongoDB, она подойдет для хранения структуры, включая объекты, списки и словари, особенно в формате близкому к JSON. Также СУБД классифицирована как PA/EC, т.е. в отсутствии разделения система гарантирует, что чтение и запись будут согласованными. Некоторые CRM-системы используют в серверной части как раз MongoDB.   
> Но это не самое лучшее решение для реализации транзакционной модели, и точно не лучший вариант для формирования отчетности.  

1.3. Отдел контроля качества решил создать базу по корпоративным нормам и правилам, обучающему материалу и так далее, сформированную согласно структуре компании. СУБД должна иметь простую и понятную структуру.

> #### Ответ:
> 
> По описанию как будто стоит использовать реляционную СУБД, где реализованы взаимосвязанные таблицы "пользователи", "учебные материалы", "нормативные документы", "курсы" назначенные на пользователей со статусом прохождения и т.д.    
> Но логичнее реализовать корпоративный портал, который будет обращаться к NoSQL СУБД, скорее всего документно-ориентированной MongoDB, т.к. это наиболее быстрый вариант, с простой и понятной структурой, и здесь как раз не требуется формирование отчетности.  

1.3.* Можно ли под эту задачу использовать уже существующую СУБД из задач выше и если да, то как лучше это реализовать? 

> #### Ответ:
> 
> Можно использовать СУБД MongoDB, которую используем для лендингов и CRM, просто в отдельных структурах документов и с разграничением доступа 

1.4. Департамент логистики нуждается в решении задач по быстрому формированию маршрутов доставки материалов по объектам и распределению курьеров по маршрутам с доставкой документов. СУБД должна уметь быстро работать со связями.

> #### Ответ:
> 
> Для этой задачи стоит использовать графовую NoSQL СУБД, я бы выбрал neo4j. Графовые СУБД - специфичный тип, предназначены для работы с графами, с их узлами, свойствами, и произвольными отношениями между узлами.  

1.4.* Можно ли к этой СУБД подключить отдел закупок или для них лучше сформировать свою СУБД в связке с СУБД логистов?

> #### Ответ:
> 
> Зависит от данных, которые там собираются хранить и обрабатывать. Графовые СУБД очень специфичны, предназначены именно для хранения связей между узлами по разным критериям, а не для структурированных данных.    
> Скорее всего для отдела закупок нужна четкая структура с постоянными связями, и лучше взять для этой задачи реляционную СУБД.  

1.5.* Можно ли все перечисленные выше задачи решить, используя одну СУБД? Если да, то какую именно?

> #### Ответ:
> 
> ***Можно*** В принципе для всего можно использовать документно-ориентированную СУБД MongoDB и частично допилить под свои нужды. Можно для всего использовать мощные реляционные СУБД Oracle или PostgreSQL опять же с реализацией сложных клиентских приложений, платформ, АРМов со своей логикой.    
> ***Но не стоит***. При выборе типа СУБД следует, прежде всего, исходить из типа решаемых задач, типов обрабатываемых данных, перспектив роста и масштабирования. Сразу все задачи решать в рамках одной СУБД - не очень хорошая идея.  

---

### Задание 2. Транзакции

2.1. Пользователь пополняет баланс счёта телефона, распишите пошагово, какие действия должны произойти для того, чтобы транзакция завершилась успешно. Ориентируйтесь на шесть действий.

> #### Ответ:
> 
> Пользователь в клиентском приложении выполняет перевод суммы X со своего счета "account-bank" на счет мобильного оператора "account-mobile". Если рассматривать именно действия в БД, без проверок на уровне приложения и без учета, что действия абсолютно точно выполняются в разных БД разных банков:
> 1. Прочесть баланс account-bank
> 2. Уменьшить баланс на сумму X
> 3. Сохранить новый баланс счета account-bank (commit)
> 4. Прочесть баланс account-mobile
> 5. Увеличить баланс на сумму X
> 6. Сохранить новый баланс счета account-mobile (commit)
> 
> На уровне выше транзакция намного сложнее. Допустим, пользователь пополняет баланс счета мобильной связи из приложения мобильного оператора.
> 1. Пользователь оформляет перевод в клиентском приложении, вводит данные своей банковской карты, сумму и т.д.
> 2. Данные о транзакции поступают на сервер процессингового центра
> 3. Проверка полученных данных системами безопасности процессингового центра (противодействие легализации и т.д.) Если в транзакции нет ничего подозрительного, то данные будут переданы банку-эквайеру (который открыл счет мобильного оператора), в то время как мобильный оператор получит извещение об успехе платежа. Если активность будет похожа на мошенническую, то платеж заблокируют, а карта, с которой пытались совершить покупку, попадет в черный список.
> 4. Банк-эквайер, получив необходимые данные о платеже, запрашивает проверку баланса пользователя у эмитента карты (а еще свои проверки безопасности)
> 5. Эмитент сообщает результаты проверки платежной системе и эквайеру (предварительно прогнав их через свою систему безопасности)
> 6. Процессинговый центр получает положительный ответ банка-эмитента, который подтверждается уникальным кодом, или же информацию об отклонении транзакции.
> 7. Мобильному оператору приходит оповещение о статусе платежа от процессингового центра.
> 8. Пользователю сообщают, что оплата прошла успешно.

2.1.* Какие действия должны произойти, если пополнение счёта телефона происходило бы через автоплатёж?

> #### Ответ:
> 
> Действия на уровне БД все те же. На уровне выше 1ый этап, где пользователь оформляет перевод в клиентском приложении, заменяется на 
> 1. Процесс/"джоб", условная CRON-задача проверяет условие совершения автоматического платежа - время-дата, баланс и т.д.
> 2. Оформляется перевод по ранее заданному пользователем шаблону
> 3. и т.д.

---

### Задание 3. SQL vs NoSQL

3.1. Напишите пять преимуществ SQL-систем по отношению к NoSQL. 

> #### Ответ:
> 
> 1. Базы данных SQL просты в использовании. Даже люди, не имеющие опыта работы с базами данных, могут научиться использовать базы данных SQL, пройдя небольшое обучение.
> 2. Они очень универсальны и могут использоваться для любых целей - от небольших персональных до крупных корпоративных баз данных, нуждающихся в хранении данных.
> 3. Базы данных SQL надежны. Они предназначены для обработки больших объемов данных и транзакций без потери или повреждения базы данных. Если в них используется распределенная база данных, это может обеспечить безопасность. В распределенной базе данные находятся в разных местах.
> 4. Всегда ожидаемый результат выполнения запросов.
> 5. SQL поддерживает сильное сообщество разработчиков. Это сообщество обеспечивает поддержку и ресурсы для предприятий и частных лиц, использующих базы данных SQL. Хотя тенденция все же смещается в сторону NoSQL, и в последнее время эти СУБД получили много поддержки и используются во многих крупных компаниях и проектах.

3.1.* Какие, на ваш взгляд, преимущества у NewSQL систем перед SQL и NoSQL.

> #### Ответ:
> 
> NewSQL объединила преимущества SQL и NoSQL, это базы данных, которые взяли новые подходы распределенных систем от NoSQL и оставили реляционную модель представления данных и язык запросов SQL. Основные преимущества:

> - Могут использовать как реляционную, так и не реляционную схему, а также расширенный SQL
> - Горизонтальное масштабирование, как и у NoSQL
> - In-memory хранение и обработка данных, существенный выигрыш в скорости
> - Они могут масштабироваться, зачастую по запросу, не влияя на логику приложения и не нарушая модель транзакций. Партицинонирование разделяет БД, и запросы выполняются на шардах отдельно, а затем объединяются в один результат.
> - Как и реляционные СУБД соответствуют правилам ACID (атомарность, согласованность, изолированность и долговечность)
> - Вторичная индексация ускоряет обработку запросов и поиск информации
> - Высокая доступность благодаря механизму репликации
> - Встроенный механизм восстановления, гибкость и безсерверная архитектура в сочетании с высокой степенью безопасности и доступности без применения резервных систем. 
> 
> Наиболее популярные базы данных NewSQL: ClustrixDB, CockroachDB, NuoDB, MemSQL и VoltDB.

---

### Задание 4. Кластеры

Необходимо производить большое количество вычислений при работе с огромным количеством данных, под эту задачу выделено 1000 машин. 

На основе какого критерия будете выбирать тип СУБД, и какая модель *распределённых вычислений* здесь справится лучше всего и почему?

> #### Ответ:
> 
> Во-первых, большое количество вычислений и огромное количество данных = Big Data. С таким может справиться только NoSQL.  
> Во-вторых, система должна быть с высокой доступностью и устойчивостью к распаду на секции, по PACELC это PA/EC или PA/EL, т.е. здесь подойдет MongoDB (PA/EC) и Cassandra (PA/EL).  
> В-третьих, нам нужно организовать кластер (MongoDB Atlas и Cassandra это поддерживают), а для распределенных вычислений использовать фреймворк MapReduce, либо Apache Spark.  
> Получаем 2 варианта стека:
> - Кластер СУБД Apache Cassandra + Apache Spark для распределенных вычислений + Elasticsearch для запросов и быстрого поиска
> - Кластер СУБД MongoDB + MongoDB Atlas + распределенные вычисления по MapReduce
>  
> P.S. *1000 машин* надеюсь, не физических =О
